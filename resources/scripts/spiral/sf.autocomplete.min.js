/*!
 * Autocomplete module v.0.1.0
 * https://github.com/sfjs/sf-module-autocomplete/
 * Copyright (c) 2016, Alex Chepura, Yauheni Yasinau, Maxim Matveev, spiralscout.com
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("sf"));else if("function"==typeof define&&define.amd)define(["sf"],e);else{var s=e("object"==typeof exports?require("sf"):t.sf);for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(this,function(t){return function(t){function e(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}var n=s(1),o=i(n),r=s(2),a=i(r);s(21),o["default"].instancesController.registerInstanceType(a["default"],"js-sf-autocomplete"),t.exports=a["default"]},function(e,s){e.exports=t},function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}var n=s(3),o=i(n),r=s(19),a=i(r);Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var l=s(1),u=i(l),c=function(t,e,s){this._construct(t,e,s)};c.prototype=(0,a["default"])(u["default"].core.BaseDOMConstructor.prototype),c.prototype.name="autocomplete",c.prototype._construct=function(t,e,s){this.init(t,e,s);var i={query:"query",suggestionsClassName:"autocomplete-hint",selectedClassName:"autocomplete-selected",deferRequestBy:500,minChars:1};this.options=t.tools.extend(this.options,i),s&&(this.options=t.tools.extend(this.options,s)),this.filled=!1,this.selectedIndex=-1,this.els={node:e,input:e,wrapper:t.helpers.domTools.closest(e,".item-form"),group:e.parentNode,hidden:document.createElement("input"),hints:null,addon:document.createElement("button")},this.els.wrapper.appendChild(this.els.hidden),this.els.hidden.setAttribute("type","hidden"),this.els.hidden.name=this.els.input.dataset.name,this.els.addon.className="btn-icon",this.els.addon.setAttribute("type","button"),this.els.group.appendChild(this.els.addon),console.log(this.options),"/"===this.options.url[this.options.url.length-1]&&(this.options.url=this.options.url.substring(0,this.options.url.length-1)),this.value=this.els.input.value,this.key=this.els.input.dataset.key,this.key&&this.value?this.setState("filled"):this.setState("search"),this.options.availableTags&&!this.options.url&&(this.options.deferRequestBy=0),this.addEventListeners()},c.prototype._key="",c.prototype.optionsToGrab={url:{value:"/",domAttr:"data-url"},allowNew:{value:!1,key:"data-allowNew"},name:{value:"autocomplete",key:"data-name"}},c.prototype.optionsToProcess={availableTags:{processor:function(t){var e=t.getElementsByClassName("js-spiral-autocomplete-available-tags")[0];if(!e||!e.innerHTML)return this.value;var s;try{s=JSON.parse(e.innerHTML)}catch(i){console.error("Failed to parse JSON -",e.innerHTML,i),s=this.value}return s}}},c.prototype.addEventListeners=function(){function t(t){"keydown"===t.type&&s.onKeyPress(t),("input"===t.type||"change"===t.type)&&s.onKeyUp(t),"click"===t.type&&s.wrap(t)}function e(){s.els.input.addEventListener("keydown",t),s.els.input.addEventListener("change",t),s.els.input.addEventListener("input",t),s.els.input.addEventListener("blur",function(){s.els.input.removeEventListener("keydown",t),s.els.input.removeEventListener("change",t),s.els.input.removeEventListener("input",t),s.els.input.removeEventListener("blur",e)},!1)}var s=this;this.els.input.addEventListener("focus",e),this.els.addon.addEventListener("click",function(){switch(s.state){case"search":s.onValueChange();break;case"filled":s.clear();break;case"add":s.addTag(!1,s.els.input.value);break;case"select":}}),this.options.availableTags&&this.els.input.addEventListener("focus",function(){s.onFocus()})},c.prototype.keys={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,BACKSPACE:8},c.prototype.getKeyByIndex=function(t){return this.els.hints.children[t].getAttribute("data-key")},c.prototype.hide=function(){this.els.hints&&(this.els.group.removeChild(this.els.hints),this.els.hints=null,this.visible=!1,this.selectedIndex=-1,""!==this.value&&this.value!==this.els.input.value&&this.setState(this.options.allowNew?"add":"search"))},c.prototype.clear=function(){this.value="",this.els.input.value="",this.els.hidden.value="",this.suggestions={},this.filled=!1,this.hide(),this.setState("search")},c.prototype.trim=function(t){return t.trim().replace(/\s+/g,"_")},c.prototype.setState=function(t){this.state!==t&&(this.els.wrapper.classList.remove("item-state-"+this.state),this.els.wrapper.classList.add("item-state-"+t),this.state=t,"filled"===t?(this.hide(),this.els.input.readOnly=!0):this.els.input.readOnly=!1)},c.prototype.addTag=function(t,e){(this.options.allowNew||t!==!0)&&(this.els.hidden.value=this.options.allowNew?e:t,this.value=e,this.els.input.value=this.value,this.suggestions={},this.filled=!0,this.setState("filled"))},c.prototype.onKeyUp=function(t){var e=this;this.disabled||(clearTimeout(this.onChangeTimeout),this.value!==this.els.input.value&&(this.findBestHint(),this.options.deferRequestBy>0?(this.options.allowNew&&this.setState("add"),this.onChangeTimeout=setTimeout(function(){e.onValueChange()},this.options.deferRequestBy)):this.onValueChange()))},c.prototype.findBestHint=function(){},c.prototype.onValueChange=function(){this.value=this.els.input.value,this.options.availableTags&&!this.options.url?this.getSuggestions(this.value):(clearTimeout(this.onChangeTimeout),this.selectedIndex=-1,this.value.length<this.options.minChars?this.hide():this.getSuggestions(this.value))},c.prototype.getSuggestions=function(t){var e=this;if(this.options.disable)return void this.setState("add");if(this.options.availableTags&&!this.options.url)if(""!=t.trim()){var s={};for(var i in this.options.availableTags)this.options.availableTags.hasOwnProperty(i)&&-1!=this.options.availableTags[i].toLowerCase().indexOf(t.toLowerCase())&&(s[i]=this.options.availableTags[i]);e.suggest(s)}else e.suggest(this.options.availableTags);else if(""!=t.trim()){null!=this.ajax&&this.ajax[1].abort();var n={};n[e.options.query]=t,this.ajax=u["default"].ajax.send({url:e.options.url,data:e.options.query,isReturnXHRToo:!0}),this.ajax[0].then(function(t){e.value&&!e.filled&&e.suggest(t.suggestions)},function(t){}),this.setState("loading")}else this.hide()},c.prototype.prepareSuggestions=function(){var t=this,e=this.value,s="";if(this.suggestions&&(!Array.isArray(this.suggestions)&&(0,o["default"])(this.suggestions).length>0||Array.isArray(this.suggestions)&&this.suggestions.length>0))if(Array.isArray(this.suggestions))this.suggestions.forEach(function(i,n){s+='<div class="'+t.options.suggestionsClassName+'" data-key="'+n+'">'+t.formatResult(i,e)+"</div>"});else for(var i in this.suggestions)this.suggestions.hasOwnProperty(i)&&(s+='<div class="'+t.options.suggestionsClassName+'" data-key="'+i+'">'+t.formatResult(this.suggestions[i],e)+"</div>");else s='<div class="alert alert-info" style="text-align: center; margin: 0;">There are no suggestions for this query.</div>';return s},c.prototype.suggest=function(t){var e=this;this.hide(),this.suggestions=t,this.els.hints=document.createElement("div"),this.els.hints.className="autocomplete-hints",this.els.hints.style.position="absolute",this.els.hints.innerHTML=this.prepareSuggestions(),this.els.group.insertBefore(this.els.hints,this.els.input.nextSibling),this.visible=!0,this.els.hints.addEventListener("click",function(t){var s="DIV"===t.target.nodeName?t.target:t.target.parentNode;s.getAttribute("data-key")&&e.select(s.getAttribute("data-key"))}),this.setState(this.options.allowNew?"add":"select")},c.prototype.escapeRegExChars=function(t){return t.replace(/[\-\[\]\/\{}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},c.prototype.formatResult=function(t,e){var s="("+this.escapeRegExChars(e)+")";return t.replace(new RegExp(s,"gi"),"<strong>$1</strong>")},c.prototype.select=function(t){this.addTag(t,this.suggestions[t])},c.prototype.onFocus=function(){this.getSuggestions("")},c.prototype.onKeyPress=function(t){var e=this;if(!this.disabled&&!this.visible&&t.which===this.keys.DOWN&&this.value)return void this.onValueChange();switch(t.which){case e.keys.RETURN:if(t.stopImmediatePropagation(),t.preventDefault(),-1===e.selectedIndex)return void(this.options.allowNew||this.value!=this.els.input.value?e.addTag(!1,e.els.input.value):e.onValueChange());e.select(e.getKeyByIndex(e.selectedIndex));break;case e.keys.UP:if(!e.visible)return;e.moveUp();break;case e.keys.DOWN:if(!e.visible)return;e.moveDown();break;default:return}t.stopImmediatePropagation(),t.preventDefault()},c.prototype.moveUp=function(){var t=this;if(-1!==this.selectedIndex)return 0===this.selectedIndex?([].forEach.call(this.els.hints.children,function(e){e.classList.remove(t.options.selectedClassName)}),void(t.selectedIndex=-1)):void this.adjustScroll(this.selectedIndex-1)},c.prototype.moveDown=function(){this.selectedIndex!==this.els.hints.children.length-1&&this.adjustScroll(this.selectedIndex+1)},c.prototype.adjustScroll=function(t){this.highlight(t);var e=this.els.hints.children[this.selectedIndex],s=this.els.hints.clientHeight,i=e.offsetTop,n=e.offsetHeight;i<this.els.hints.scrollTop?this.els.hints.scrollTop=i:i>this.els.hints.scrollTop+s-n&&(this.els.hints.scrollTop=i-s+n)},c.prototype.highlight=function(t){var e=this;return[].forEach.call(this.els.hints.children,function(t){t.classList.remove(e.options.selectedClassName)}),this.els.hints.children[t].classList.add(e.options.selectedClassName),this.selectedIndex=t,null},c.prototype.die=function(){console.error("TODO DIE")},e["default"]=c},function(t,e,s){t.exports={"default":s(4),__esModule:!0}},function(t,e,s){var i=s(5);s(6),t.exports=function(t){return i.getNames(t)}},function(t,e){var s=Object;t.exports={create:s.create,getProto:s.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:s.getOwnPropertyDescriptor,setDesc:s.defineProperty,setDescs:s.defineProperties,getKeys:s.keys,getNames:s.getOwnPropertyNames,getSymbols:s.getOwnPropertySymbols,each:[].forEach}},function(t,e,s){s(7)("getOwnPropertyNames",function(){return s(14).get})},function(t,e,s){var i=s(8),n=s(10),o=s(13);t.exports=function(t,e){var s=(n.Object||{})[t]||Object[t],r={};r[t]=e(s),i(i.S+i.F*o(function(){s(1)}),"Object",r)}},function(t,e,s){var i=s(9),n=s(10),o=s(11),r="prototype",a=function(t,e,s){var l,u,c,p=t&a.F,h=t&a.G,d=t&a.S,f=t&a.P,g=t&a.B,v=t&a.W,m=h?n:n[e]||(n[e]={}),y=h?i:d?i[e]:(i[e]||{})[r];h&&(s=e);for(l in s)u=!p&&y&&l in y,u&&l in m||(c=u?y[l]:s[l],m[l]=h&&"function"!=typeof y[l]?s[l]:g&&u?o(c,i):v&&y[l]==c?function(t){var e=function(e){return this instanceof t?new t(e):t(e)};return e[r]=t[r],e}(c):f&&"function"==typeof c?o(Function.call,c):c,f&&((m[r]||(m[r]={}))[l]=c))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,t.exports=a},function(t,e){var s=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=s)},function(t,e){var s=t.exports={version:"1.2.6"};"number"==typeof __e&&(__e=s)},function(t,e,s){var i=s(12);t.exports=function(t,e,s){if(i(t),void 0===e)return t;switch(s){case 1:return function(s){return t.call(e,s)};case 2:return function(s,i){return t.call(e,s,i)};case 3:return function(s,i,n){return t.call(e,s,i,n)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},function(t,e,s){var i=s(15),n=s(5).getNames,o={}.toString,r="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(t){try{return n(t)}catch(e){return r.slice()}};t.exports.get=function(t){return r&&"[object Window]"==o.call(t)?a(t):n(i(t))}},function(t,e,s){var i=s(16),n=s(18);t.exports=function(t){return i(n(t))}},function(t,e,s){var i=s(17);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e){var s={}.toString;t.exports=function(t){return s.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,s){t.exports={"default":s(20),__esModule:!0}},function(t,e,s){var i=s(5);t.exports=function(t,e){return i.create(t,e)}},function(t,e,s){var i=s(22);"string"==typeof i&&(i=[[t.id,i,""]]);s(24)(i,{});i.locals&&(t.exports=i.locals)},function(t,e,s){e=t.exports=s(23)(),e.push([t.id,".item-form{position:relative}.item-autocomplete.item-state-search .btn-icon:before{content:'\\26B2';transform:rotate(-45deg);display:inline-block}.item-autocomplete.item-state-add .btn-icon:before{content:'+'}.item-autocomplete.item-state-filled .btn-icon:before{content:'\\D7'}.item-autocomplete.item-state-select .btn-icon:hover{opacity:.2;cursor:default}.item-autocomplete.item-state-select .btn-icon:before{content:'\\21D9'}.item-autocomplete.item-state-loading .btn-icon:before{content:'\\21BB'}.item-autocomplete .btn-icon{position:absolute;top:0;right:0;height:100%;width:30px;font-size:24px;line-height:100%}.item-autocomplete .btn-icon:before{line-height:100%;vertical-align:text-top;height:100%}.item-autocomplete .autocomplete-hints{background:#fff;border:1px solid #000;border-bottom-left-radius:2px;border-bottom-right-radius:2px;margin-top:-1px;max-width:100%;width:100%;max-height:200px;overflow-y:scroll}.item-autocomplete .autocomplete-hints>.autocomplete-hint{padding:3px 10px;cursor:pointer}.item-autocomplete .autocomplete-hints>.autocomplete-hint.autocomplete-selected,.item-autocomplete .autocomplete-hints>.autocomplete-hint:hover{background:grey}.item-autocomplete .autocomplete-hints strong{color:blue;font-weight:400}",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var s=this[e];s[2]?t.push("@media "+s[2]+"{"+s[1]+"}"):t.push(s[1])}return t.join("")},t.i=function(e,s){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},n=0;n<this.length;n++){var o=this[n][0];"number"==typeof o&&(i[o]=!0)}for(n=0;n<e.length;n++){var r=e[n];"number"==typeof r[0]&&i[r[0]]||(s&&!r[2]?r[2]=s:s&&(r[2]="("+r[2]+") and ("+s+")"),t.push(r))}},t}},function(t,e,s){function i(t,e){for(var s=0;s<t.length;s++){var i=t[s],n=d[i.id];if(n){n.refs++;for(var o=0;o<n.parts.length;o++)n.parts[o](i.parts[o]);for(;o<i.parts.length;o++)n.parts.push(u(i.parts[o],e))}else{for(var r=[],o=0;o<i.parts.length;o++)r.push(u(i.parts[o],e));d[i.id]={id:i.id,refs:1,parts:r}}}}function n(t){for(var e=[],s={},i=0;i<t.length;i++){var n=t[i],o=n[0],r=n[1],a=n[2],l=n[3],u={css:r,media:a,sourceMap:l};s[o]?s[o].parts.push(u):e.push(s[o]={id:o,parts:[u]})}return e}function o(t,e){var s=v(),i=b[b.length-1];if("top"===t.insertAt)i?i.nextSibling?s.insertBefore(e,i.nextSibling):s.appendChild(e):s.insertBefore(e,s.firstChild),b.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");s.appendChild(e)}}function r(t){t.parentNode.removeChild(t);var e=b.indexOf(t);e>=0&&b.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",o(t,e),e}function l(t){var e=document.createElement("link");return e.rel="stylesheet",o(t,e),e}function u(t,e){var s,i,n;if(e.singleton){var o=y++;s=m||(m=a(e)),i=c.bind(null,s,o,!1),n=c.bind(null,s,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(s=l(e),i=h.bind(null,s),n=function(){r(s),s.href&&URL.revokeObjectURL(s.href)}):(s=a(e),i=p.bind(null,s),n=function(){r(s)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else n()}}function c(t,e,s,i){var n=s?"":i.css;if(t.styleSheet)t.styleSheet.cssText=x(e,n);else{var o=document.createTextNode(n),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}function p(t,e){var s=e.css,i=e.media;e.sourceMap;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}function h(t,e){var s=e.css,i=(e.media,e.sourceMap);i&&(s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var n=new Blob([s],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(n),o&&URL.revokeObjectURL(o)}var d={},f=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},g=f(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),v=f(function(){return document.head||document.getElementsByTagName("head")[0]}),m=null,y=0,b=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=g()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var s=n(t);return i(s,e),function(t){for(var o=[],r=0;r<s.length;r++){var a=s[r],l=d[a.id];l.refs--,o.push(l)}if(t){var u=n(t);i(u,e)}for(var r=0;r<o.length;r++){var l=o[r];if(0===l.refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete d[l.id]}}}};var x=function(){var t=[];return function(e,s){return t[e]=s,t.filter(Boolean).join("\n")}}()}])});
//# sourceMappingURL=sf.autocomplete.min.js.map